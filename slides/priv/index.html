<!DOCTYPE html>
<html>
<head>


    <!-- And the relevant JavaScript -->
    <script src="js/jquery-3.1.1.min.js"></script>
    <script src="js/unslider-min.js"></script> <!-- but with the right path! -->
    <link rel="stylesheet" href="css/unslider.css">
    <link rel="stylesheet" href="css/unslider-dots.css">

    <link rel="stylesheet" href="css/slides.css">


    <script type="text/javascript">
      
      var websocket;
      $(document).ready(init);
      
      function init() {
          wsHost = "ws://" + window.location.host + "/websocket";
          if(!("WebSocket" in window)){  
              $('#status').append('<p><span style="color: red;">websockets are not supported </span></p>');
              $("#navigation").hide();  
          } else {
              $('#status').append('<p>websockets are supported</p>');
              connect(wsHost);
          };
              $("#container_info").hide(); 	
      };
      function connect(wsHost)
      {
          websocket = new WebSocket(wsHost);
          showScreen('<b>Connecting to: ' +  wsHost + '</b>'); 
          websocket.onopen = function(evt) { onOpen(evt) }; 
          websocket.onclose = function(evt) { onClose(evt) }; 
          websocket.onmessage = function(evt) { onMessage(evt) }; 
          websocket.onerror = function(evt) { onError(evt) }; 
      };  
      
      function disconnect() {
          websocket.close();
      }; 
      function toggle_connection(){
          if(websocket.readyState == websocket.OPEN){
              disconnect();
          } else {
              connect();
          };
      };
      
      function onOpen(evt) { 
          $('#ws_status').text("OK");

      };  
      function onClose(evt) { 
          $('#ws_status').text("Disconnect");
      };  
      function onMessage(evt) { 
           
           $('#nodes_table tbody').empty();
           var data = $.parseJSON(evt.data);
           $.each(data, function(i, item) {
             $('<tr>').html(
             "<td>" + data[i].node + "</td><td>" + data[i].detail.total + "</td><td>" + data[i].detail.processes +"</td><td>" + data[i].detail.processes_used +"</td>"+
             "<td>" +data[i].detail.system + "</td><td>" + data[i].detail.atom_used +"</td><td>" + data[i].web_socket_connected +"</td>"

             ).appendTo('#nodes_body');
            });

           var count = 0
           for (i = 0; i < data.length; i++) {  
               count += data[i].web_socket_connected;  
            }
          
            $('#ws_count').text("Clients:" + count);
            $("#container_info").fadeIn('slow');
          
      };  
      function onError(evt) {
          $('#ws_status').text("WS error:" + evt.data);
     };
      function format_date(d){

      	
		var datestring = ("0" + d.getDate()).slice(-2) + "-" + ("0"+(d.getMonth()+1)).slice(-2) + "-" +
	    d.getFullYear() + " " + ("0" + d.getHours()).slice(-2) + ":" + ("0" + d.getMinutes()).slice(-2);

		return datestring;
      }

      function showScreen(txt) {


          $('#output').html("Cluster info: " + txt);
      };
      function clearScreen() 
      { 
          $('#output').html("");
      };


    </script>

</head>


<div id="container" class="banner">
    <div class="default-slider">
        <ul>
            <li> <h1> Build a distributed application with BEAM </h1>
            <h1>
            <li> - Gabriele Santomaggio - @gsantomaggio</li>
            <li> - Working at Erlang Solutions - London</li>
            <li> - RabbitMQ contributor/ stackoverflow supporter</li>
            <li> - Co-author of RabbitMQ Cookbook</li>
            </h1>
            </li>


            <li> <h1> Distributed Erlang - Base concepts </h1>
            <h1>
            <li> - erl -sname (example)</li>
            <li> - Connect to other node</li>
            <li> - .erlang.cookie</li>
            <li> - epmd</li>
            </h1></li>

            <li> <h1> Distributed calls </h1>
            <h1>
            <li> - Synchronous distributed call </li>
            <li> - Replies and Bad Nodes </li>
            <li> - Time-out or not time-out this is the question</li>
            <li> - Make a asynchronous distributed call </li>
            </h1></li>

            <li> <h1> Synchronous distributed call in this presentation </h1>
            <h1>
            <li> - Erlang-OTP</li>
            <li> - gen_server </li>
            <li> - gen_server:multi_call([node() | nodes()], server_info</li>
            <li> - Read the response </li>
            </h1></li>

            <li> <h1> Add new feature </h1>
            <h1>
            <li> - Search example </li>
            <li> - </li>
            <li> - </li>
            <li> - </li>
            </h1></li>

            <li> <h1> Nodes type family </h1>
            <h1>
            <li> - Same type </li>
            <li> - Connect different families</li>
            <li> - Standard TCP/UPD connections </li>
            <li> - SSL and/or different cookie</li>
            </h1></li>

            <li> <h1> Nodes type family - Example</h1>
            <h1>
            <li>  </li>
            <li> </li>
            <li>  </li>
            <li> </li>
            </h1></li>
  

        </ul>
        <script>$('.default-slider').unslider();</script>
    </div>
</div>



<div id="container_info">
<div style="display: inline-block;">
    <table id="nodes_table"> 
    <thead>
     
        <tr>
          <th>Node</th>
          <th>Total</th>
          <th>Processes</th>
          <th>Processes Used</th>
          <th>System</th>
          <th>Atoms Used</th>
          <th>Clients WS</th>
        </tr>
      </thead>

        <tbody id="nodes_body">  </tbody>
    </table>
</div>

<div style="display: inline-block; margin-left:auto; margin-right:0;vertical-align: top;">
    <table id="ws_table"> 
      <tr><td style="border: 1px solid yellow;background-color: #282828;"><span id="ws_status"></span></td></tr>
      <tr><td style="border: 1px solid yellow;background-color: #282828;"><span id="ws_count"></span></td></tr>
    </table>
</div>



</div>



</body>
</html>